#!/usr/bin/env ruby

require 'methadone'
require 'AWSAttachVolume'

class App
  include Methadone::Main
  include Methadone::CLILogging
  include Methadone::ExitNow

  main do |action|
    if options[:device].nil? || options[:volume_id].nil?
      help_now!("Missing required argument!")
    end
    AWSAttachVolume::Main.new(options).run
  end

  options[:move] = true

  # Proxy to an OptionParser instance's on method
  on("-r REGION", "--region")
  on("-v VOLUME_ID", "--volume_id", "Required")
  on("-i INSTANCE_ID","--instance_id", "Required")
  on("-d DEVICE", "--device")
  on("-m", "--move", "Snapshot, restore, and delete old volume + snapshot if volume is in different AZ. Copies over tags as well")

  use_log_level_option

  go!
end
